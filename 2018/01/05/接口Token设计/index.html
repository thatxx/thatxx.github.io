<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="gxii,xx.wand@gmail.com"><title>接口Token的设计 · gxii's blog</title><meta name="description" content="前阵子因为负责的项目要和其他系统对接，做了接口开放给其他开发单位调用，出于安全性的需要，给接口设计了token鉴权机制。设计接口需要考虑的地方有很多，本篇总结关于token设计的一些要点。  
应用场景在对外开放接口时，调用者即用即走，无需维护会话状态，例如淘宝的开放接口token验证、微信开发平台"><meta name="keywords" content="Hexo,HTML,CSS,java,full-stack"><meta content="#f5f5f5" name="msapplication-navbutton-color"><meta name="theme-color" content="#f5f5f5"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">gxii's blog</a></h3><div class="description"><p>乍见之欢 久处不厌</p></div></div></div><ul class="social-links"><li><a href="http://instagram.com/gxii_"><i class="fa fa-instagram"></i></a></li><li><a href="http://weibo.com/137908080"><i class="fa fa-weibo"></i></a></li><li><a href="http://github.com/thatxx"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友链</a></li><li><a href="/about">关于</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img src="/images/avatar.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>接口Token的设计</a></h3></div><div class="post-content"><p>前阵子因为负责的项目要和其他系统对接，做了接口开放给其他开发单位调用，出于安全性的需要，给接口设计了token鉴权机制。设计接口需要考虑的地方有很多，本篇总结关于token设计的一些要点。  </p>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><p>在对外开放接口时，调用者即用即走，无需维护会话状态，例如淘宝的开放接口token验证、微信开发平台token验证等</p>
<h3 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h3><p>数据在网络中传输一般会遇到以下的安全问题：</p>
<ol>
<li>请求被监听，如果其中包含敏感性的数据如账号密码，那么会导致身份泄露  </li>
<li>请求被拦截后篡改，导致接口提供者接受到错误的数据  </li>
<li>请求被记录后重放，同样会导致接口提供者接受到错误的数据<br>在启用https的情况，我们可以基本确保请求的安全性，但在未在未启用https的情况下，如何有效的请求被拦截监听的影响？<br>一个可靠的接口token鉴权机制应该确保用户身份不容易被盗取冒用，如果将识别用户身份的账号密码参与传输，一旦请求被拦截监听到了，那么用户身份被窃取了。对此，我们可以为接口调用的应用分配一个app_id和app_key。app_id用于识别接口调用者身份，参与传输，而app_key用于验证调用者身份，由接口调用者和使用者分别持有，不参与传输。<br>既然app_key不参与传输，又怎么验证用户身份呢，我们可以把参数按照一定的规则处理成字符串，然后将此字符串与app_key一起进行加密，然后将得到的签名参与传输。接口提供者收到请求后，根据app_id找到对应的app_key，按照一样的规则对参数进行处理，若得到的签名与请求中的签名一致，则可判断出该请求是合法的。<br>这样，即使请求被拦截修改，由于app_key不参与传输，签名无法被伪造，接口提供者计算签名后便能发现请求被篡改了。<br>最后，只要在请求参数中加入时间戳，参与签名计算，接口提供者验证签名通过后，再判断请求的时间戳与当前时间戳差值是否在允许范围内即可防止重放攻击。<br>整体流程如下：<br><img src="/images/接口token校验流程.jpg" alt="alt 接口调用流程图"></li>
</ol>
<h3 id="EOF"><a href="#EOF" class="headerlink" title="EOF"></a>EOF</h3></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-01-05</span><i class="fa fa-comment-o"></i><a href="/2018/01/05/接口Token设计/#comments">评论</a><i class="fa fa-tag"></i><a href="/categories/架构设计/" title="架构设计" class="tag">架构设计 </a><a href="/tags/api-token/" title="api token" class="tag">api token </a></div></div></div></div><div class="share"><div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"><a href="http://twitter.com/home?status=,http://yoursite.com/2018/01/05/接口Token设计/,gxii's blog,接口Token的设计,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2018/08/20/前后端分离集成cas+ldap单点登陆/" title="前后端分离项目接入CAS单点登陆" class="btn">上一篇</a></li><li class="next pagbuttons"><a role="navigation" href="/2017/11/15/linux下vsftpd服务搭建/" title="linux下vsftpd服务搭建" class="btn">下一篇</a></li></ul></div><a id="comments"></a><div id="disqus_thread"></div><script>var disqus_shortname = 'gxii';
var disqus_identifier = '2018/01/05/接口Token设计/';
var disqus_title = '接口Token的设计';
var disqus_url = 'http://yoursite.com/2018/01/05/接口Token设计/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//gxii.disqus.com/count.js" async></script></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>